import React, { useEffect, useRef, useMemo } from 'react';
import { motion } from 'framer-motion';
// Removed missing QuantumState import as it is unused in this suite
import { SpaceSector } from '../types';

export const SchrodingerOscilloscope: React.FC<{ superposition: number }> = ({ superposition }) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const timeRef = useRef(0);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    const draw = () => {
      const { width: w, height: h } = canvas;
      ctx.clearRect(0, 0, w, h);

      ctx.strokeStyle = '#00FFCC';
      ctx.lineWidth = 1.5;
      ctx.shadowBlur = 15;
      ctx.shadowColor = '#00FFCC';
      
      const midY = h / 2;
      const uncertainty = superposition / 100;

      // Draw Wave Function (Probability Density)
      ctx.beginPath();
      for (let x = 0; x < w; x++) {
        const t = timeRef.current;
        const phase = (x * 0.02) - t;
        
        // Schrödinger interference pattern simulation
        const wave1 = Math.sin(phase);
        const wave2 = Math.sin(phase * 1.5 + t * 0.5) * uncertainty;
        const wave3 = Math.cos(phase * 0.5 - t * 0.2) * (1 - uncertainty);
        
        const y = (wave1 + wave2 + wave3) * 30;
        const plotY = midY + y;

        if (x === 0) ctx.moveTo(x, plotY);
        else ctx.lineTo(x, plotY);
      }
      ctx.stroke();

      // Envelope / Uncertainty cloud
      ctx.fillStyle = 'rgba(0, 255, 204, 0.05)';
      ctx.beginPath();
      for (let x = 0; x < w; x++) {
        const env = Math.sin(x * 0.01) * 40 * uncertainty;
        ctx.rect(x, midY - env, 1, env * 2);
      }
      ctx.fill();

      timeRef.current += 0.05;
      requestAnimationFrame(draw);
    };

    const anim = requestAnimationFrame(draw);
    return () => cancelAnimationFrame(anim);
  }, [superposition]);

  return (
    <div className="relative w-full h-full bg-black/40 border border-teal-500/20 rounded-sm overflow-hidden">
      <canvas ref={canvasRef} width={800} height={150} className="w-full h-full" />
      <div className="absolute top-2 left-2 text-[8px] font-bold text-teal-500 tracking-widest uppercase opacity-60">
        Ψ Waveform Function :: Resonance α
      </div>
    </div>
  );
};

export const SemiconductorHeatmap: React.FC<{ coreTemp: number }> = ({ coreTemp }) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    const particles = Array.from({ length: 40 }, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      vx: Math.random() * 2 - 1,
      vy: Math.random() * 2 - 1,
    }));

    const draw = () => {
      ctx.fillStyle = 'rgba(0,0,0,0.1)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Temperature gradient based on coreTemp
      const heatFactor = (coreTemp - 200) / 400; // Normalized 200K to 600K
      const color = `rgba(${255 * heatFactor}, ${200 * (1 - heatFactor)}, 255, 0.5)`;

      particles.forEach(p => {
        p.x += p.vx * (1 + heatFactor * 5);
        p.y += p.vy * (1 + heatFactor * 5);

        if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
        if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 1.5, 0, Math.PI * 2);
        ctx.fill();
      });

      // Grid
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
      ctx.lineWidth = 0.5;
      for (let i = 0; i < canvas.width; i += 20) {
        ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); ctx.stroke();
      }
      for (let i = 0; i < canvas.height; i += 20) {
        ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(canvas.width, i); ctx.stroke();
      }

      requestAnimationFrame(draw);
    };

    const anim = requestAnimationFrame(draw);
    return () => cancelAnimationFrame(anim);
  }, [coreTemp]);

  return (
    <div className="relative w-full h-full industrial-panel rounded-sm overflow-hidden p-2">
      <div className="flex justify-between text-[8px] font-bold text-gray-500 uppercase mb-1">
        <span>Semiconductor Core</span>
        <span className={coreTemp > 500 ? 'text-red-500 animate-pulse' : 'text-teal-500'}>{coreTemp.toFixed(1)}K</span>
      </div>
      <canvas ref={canvasRef} width={200} height={100} className="w-full h-24 bg-black/80" />
    </div>
  );
};

export const NanoScannerHUD: React.FC<{ sector: SpaceSector | null }> = ({ sector }) => {
  return (
    <div className="absolute inset-0 pointer-events-none flex items-center justify-center">
      <div className="w-[600px] h-[400px] border border-teal-500/10 relative overflow-hidden">
        {/* Scanning Line */}
        <motion.div 
          animate={{ top: ['0%', '100%', '0%'] }}
          transition={{ duration: 4, repeat: Infinity, ease: 'linear' }}
          className="absolute left-0 right-0 h-0.5 bg-teal-400 shadow-[0_0_15px_#00FFCC] z-10"
        />
        
        {/* Atomic Data Overlays */}
        {sector && (
          <div className="absolute top-4 left-4 space-y-2 opacity-40">
            <div className="text-[10px] font-bold text-teal-400 tracking-tighter">ATOMIC_COMPOSITION_ANALYSIS:</div>
            <div className="grid grid-cols-2 gap-x-4 gap-y-1 text-[9px] font-mono">
              <span>HE: {sector.atmosphere?.argon || 1.2}%</span>
              <span>O2: {sector.atmosphere?.oxygen || 21}%</span>
              <span>N2: {sector.atmosphere?.nitrogen || 78}%</span>
              <span>C: 0.04%</span>
            </div>
          </div>
        )}

        {/* Quadrant Markers */}
        <div className="absolute top-0 left-1/2 -translate-x-1/2 h-full w-px bg-teal-500/10" />
        <div className="absolute left-0 top-1/2 -translate-y-1/2 w-full h-px bg-teal-500/10" />
      </div>
    </div>
  );
};

